<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="./style.css">
  <title>PCM inventory forum</title>
</head>
<body>
  <h1>Product Intake Form</h1>

  <!-- Checkbox for "Need" and "Selling" -->
  <label>
    <input type="radio" name="intention" value="Need" id="needCheckbox" onchange="updateTextColor()"> Need
  </label>
  <label>
    <input type="radio" name="intention" value="Selling" id="sellingCheckbox" onchange="updateTextColor()"> Selling
  </label>

  <form id="intakeForm">
    <label for="product">Product:</label>
    <input type="text" id="product" name="product" required><br><br>

    <label for="sku">SKU:</label>
    <input type="text" id="sku" name="sku" required><br><br>

    <label for="qty">Quantity:</label>
    <input type="number" id="qty" name="qty" required><br><br>

    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required><br><br>

    <!-- Checkbox to enable Selling Price input -->
    <label>
      <input type="checkbox" id="sellingPriceCheckbox" onchange="toggleSellingPrice()"> Include Selling Price
    </label>
    
    <div id="sellingPriceField" style="display: none;">
      <label for="sellingPrice">Selling Price:</label>
      <input type="number" id="sellingPrice" name="sellingPrice"><br><br>
    </div>

    <input type="submit" value="Submit">
  </form>

  <h2>Recent Submissions:</h2>
  <div id="submissionList"></div>

  <script>
    // Function to save submissions to localStorage
    function saveSubmissionToLocalStorage(timestamp, product, sku, qty, email, intention, sellingPrice) {
      const submissions = JSON.parse(localStorage.getItem('submissions')) || [];
      submissions.unshift({ timestamp, product, sku, qty, email, intention, sellingPrice });
      localStorage.setItem('submissions', JSON.stringify(submissions));
    }

    // Function to load saved submissions from localStorage
    function loadSubmissionsFromLocalStorage() {
      const submissions = JSON.parse(localStorage.getItem('submissions')) || [];

      for (const submission of submissions) {
        addSubmission(
          submission.timestamp,
          submission.product,
          submission.sku,
          submission.qty,
          submission.email,
          submission.intention,
          submission.sellingPrice
        );
      }
    }

    // Function to initialize the page
    function initializePage() {
      loadSubmissionsFromLocalStorage();
    }

    // Function to add a new submission to the list
    function addSubmission(timestamp, product, sku, qty, email, intention, sellingPrice) {
      const submissionList = document.getElementById('submissionList');
      const submissionDiv = document.createElement('div');

      // Determine text color based on intention
      let textColor = 'black';
      if (intention === 'Need') {
        textColor = 'blue';
      } else if (intention === 'Selling') {
        textColor = 'red';
      }

      submissionDiv.innerHTML = `
        <hr>
        <p><strong>Timestamp:</strong> ${timestamp}</p>
        <p><strong>Product:</strong> <span style="color: ${textColor};">${product}</span></p>
        <p><strong>SKU:</strong> ${sku}</p>
        <p><strong>Quantity:</strong> ${qty}</p>
        <p><strong>Email:</strong> ${email}</p>
        <p><strong>Intention:</strong> ${intention}</p>
        ${intention === 'selling' ? `<p><strong>Selling Price:</strong> $${sellingPrice}</p>` : ''}
      `;
      submissionList.insertBefore(submissionDiv, submissionList.firstChild);
    }

    // Function to toggle visibility of Selling Price input field
    function toggleSellingPrice() {
      const sellingPriceCheckbox = document.getElementById('sellingPriceCheckbox');
      const sellingPriceField = document.getElementById('sellingPriceField');

      sellingPriceField.style.display = sellingPriceCheckbox.checked ? 'block' : 'none';
    }

    // Function to update text color based on checkbox selection
    function updateTextColor() {
      const needCheckbox = document.getElementById('needCheckbox');
      const sellingCheckbox = document.getElementById('sellingCheckbox');
      const productInput = document.getElementById('product');

      if (needCheckbox.checked) {
        productInput.style.color = 'blue';
      } else if (sellingCheckbox.checked) {
        productInput.style.color = 'red';
      } else {
        productInput.style.color = 'black';
      }
    }

    // Function to handle form submission
    document.getElementById('intakeForm').addEventListener('submit', function(event) {
      event.preventDefault(); // Prevent the form from actually submitting

      // Get form values
      const product = document.getElementById('product').value;
      const sku = document.getElementById('sku').value;
      const qty = document.getElementById('qty').value;
      const email = document.getElementById('email').value;
      const intention = document.querySelector('input[name="intention"]:checked').value;
      const sellingPriceCheckbox = document.getElementById('sellingPriceCheckbox');
      const sellingPrice = sellingPriceCheckbox.checked ? document.getElementById('sellingPrice').value : '';

      // Get current timestamp
      const timestamp = new Date().toLocaleString();

      // Add the submission to the list
      addSubmission(timestamp, product, sku, qty, email, intention, sellingPrice);

      // Save the submission to localStorage
      saveSubmissionToLocalStorage(timestamp, product, sku, qty, email, intention, sellingPrice);

      // Clear the form and reset text color
      document.getElementById('intakeForm').reset();
      document.getElementById('product').style.color = 'black';
      // Reset the Selling Price input visibility
      toggleSellingPrice();
    });

    // Initialize the page when it loads
    initializePage();
  </script>
</body>
</html>
